\hypertarget{_r_type_server_8cpp_source}{}\doxysection{RType\+Server.\+cpp}
\label{_r_type_server_8cpp_source}\index{Server/src/Networking/RTypeServer.cpp@{Server/src/Networking/RTypeServer.cpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00001}00001 \textcolor{preprocessor}{\#include "{}RTypeServer.hpp"{}}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00002}00002 \textcolor{preprocessor}{\#include <iostream>}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00003}00003 \textcolor{preprocessor}{\#include "{}ClientManager.hpp"{}}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00004}00004 }
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00008}00008 \textcolor{comment}{/* RTypeServer::RTypeServer(boost::asio::io\_context\& io\_context, short port)}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00009}00009 \textcolor{comment}{    : io\_context\_(io\_context),}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00010}00010 \textcolor{comment}{    socket\_(io\_context, boost::asio::ip::udp::endpoint(boost::asio::ip::udp::v4(), port))}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00011}00011 \textcolor{comment}{\{}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00012}00012 \textcolor{comment}{    start\_receiving();}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00013}00013 \textcolor{comment}{\} */}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00014}00014 }
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00018}00018 \textcolor{comment}{/* void RTypeServer::start\_receiving() \{}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00019}00019 \textcolor{comment}{    socket\_.async\_receive\_from(}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00020}00020 \textcolor{comment}{        boost::asio::buffer(data\_, max\_length), remote\_endpoint\_,}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00021}00021 \textcolor{comment}{        [this](const boost::system::error\_code\& ec, std::size\_t bytes\_transferred) \{}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00022}00022 \textcolor{comment}{            if (!ec) \{}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00023}00023 \textcolor{comment}{                handle\_receive(ec, bytes\_transferred);}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00024}00024 \textcolor{comment}{                start\_receiving();  // Continue listening}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00025}00025 \textcolor{comment}{            \} else \{}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00027}00027 \textcolor{comment}{                std::cout << "{}Erreur lors de la réception des données: "{} << ec.message() << std::endl;}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00028}00028 \textcolor{comment}{                }}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00029}00029 \textcolor{comment}{                if (ec == boost::asio::error::connection\_reset ||}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00030}00030 \textcolor{comment}{                    ec == boost::asio::error::broken\_pipe) \{}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00031}00031 \textcolor{comment}{                    std::cout << "{}Le client "{} << remote\_endpoint\_ << "{} semble s'être déconnecté ou a crashé."{} << std::endl;}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00032}00032 \textcolor{comment}{                \}}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00033}00033 \textcolor{comment}{                }}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00034}00034 \textcolor{comment}{                // Possible client removal logic here}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00035}00035 \textcolor{comment}{                // ...}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00036}00036 \textcolor{comment}{                }}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00037}00037 \textcolor{comment}{                // Optionally continue listening}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00038}00038 \textcolor{comment}{                start\_receiving();}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00039}00039 \textcolor{comment}{            \}}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00040}00040 \textcolor{comment}{        \});}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00041}00041 \textcolor{comment}{\}}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00042}00042 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00047}00047 \textcolor{comment}{/* void RTypeServer::handle\_receive(const boost::system::error\_code\& error, std::size\_t )//bytes\_transferred}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00048}00048 \textcolor{comment}{\{}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00049}00049 \textcolor{comment}{    if (!error)}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00050}00050 \textcolor{comment}{    \{}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00051}00051 \textcolor{comment}{        // Check for known client}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00052}00052 \textcolor{comment}{        auto it = std::find\_if(knownClients.begin(), knownClients.end(),}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00053}00053 \textcolor{comment}{            [this](const ClientInfo\& info) \{}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00054}00054 \textcolor{comment}{                return info.endpoint == remote\_endpoint\_;}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00055}00055 \textcolor{comment}{            \});}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00056}00056 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00057}00057 \textcolor{comment}{        // If client is new, add to known clients and assign an ID}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00058}00058 \textcolor{comment}{        if (it == knownClients.end()) \{}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00059}00059 \textcolor{comment}{            knownClients.push\_back(\{remote\_endpoint\_, clientIdCounter\});}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00060}00060 \textcolor{comment}{            std::cout << "{}Client "{} << clientIdCounter << "{} connected."{} << std::endl;}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00061}00061 \textcolor{comment}{            ++clientIdCounter;}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00062}00062 \textcolor{comment}{        \}}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00063}00063 \textcolor{comment}{        }}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00064}00064 \textcolor{comment}{        // Check if all expected clients are connected}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00065}00065 \textcolor{comment}{        if (clientIdCounter == 4) \{}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00066}00066 \textcolor{comment}{            std::cout << "{}All clients connected."{} << std::endl;}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00067}00067 \textcolor{comment}{        \}}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00068}00068 \textcolor{comment}{        struct data d = readData();}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00069}00069 \textcolor{comment}{        // Continue receiving}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00070}00070 \textcolor{comment}{        start\_receiving();}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00071}00071 \textcolor{comment}{    \}}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00072}00072 \textcolor{comment}{\}}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00073}00073 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00074}00074 \textcolor{comment}{struct data RTypeServer::readData()}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00075}00075 \textcolor{comment}{\{}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00076}00076 \textcolor{comment}{    struct data d = \{-\/1, -\/1, -\/1\};}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00077}00077 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00078}00078 \textcolor{comment}{    // istream\_.read(reinterpret\_cast<char*>(\&d.id), sizeof(int));}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00079}00079 \textcolor{comment}{    // istream\_.read(reinterpret\_cast<char*>(\&d.event), sizeof(int));}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00080}00080 \textcolor{comment}{    // istream\_.read(reinterpret\_cast<char*>(\&d.dir), sizeof(int));}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00081}00081 \textcolor{comment}{    // std::cout << "{}id: "{} << d.id << std::endl;}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00082}00082 \textcolor{comment}{    // std::cout << "{}event: "{} << d.event << std::endl;}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00083}00083 \textcolor{comment}{    // std::cout << "{}dir: "{} << d.dir << std::endl;}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00084}00084 \textcolor{comment}{    auto buff = CStreamBuffer\_.getCStreamBuffer().prepare(1024);}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00085}00085 \textcolor{comment}{    CStreamBuffer\_.readData();}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00086}00086 \textcolor{comment}{    socket\_.async\_receive\_from(buff, remote\_endpoint\_,}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00087}00087 \textcolor{comment}{        std::bind(\&RTypeServer::routine, this, std::placeholders::\_1, std::placeholders::\_2));}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00088}00088 \textcolor{comment}{    return d;}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00089}00089 \textcolor{comment}{\}}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00090}00090 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00091}00091 \textcolor{comment}{void RTypeServer::routine(const boost::system::error\_code \&, std::size\_t btrs)}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00092}00092 \textcolor{comment}{\{\}}}
\DoxyCodeLine{\Hypertarget{_r_type_server_8cpp_source_l00093}00093 \textcolor{comment}{ */}}

\end{DoxyCode}
